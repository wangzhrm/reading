<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vocabulary Quiz & Attendance Tool</title>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            width: 90%;
            max-width: 800px;
            padding: 30px;
            margin: 20px 0;
        }
        
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 20px;
        }
        
        .section {
            display: none;
            padding: 20px;
        }
        
        #setup-section {
            display: block;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #444;
        }
        
        select, button {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #ddd;
            font-size: 16px;
        }
        
        select {
            background-color: #f9f9f9;
            margin-bottom: 15px;
        }
        
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #45a049;
        }
        
        #not-here-btn {
            background-color: #f44336;
            margin-top: 15px;
        }
        
        #not-here-btn:hover {
            background-color: #d32f2f;
        }
        
        .quiz-card {
            text-align: center;
            padding: 25px;
            border: 1px solid #eee;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 20px;
        }
        
        .student-name {
            font-size: 28px;
            color: #2c3e50;
            margin-bottom: 25px;
            font-weight: 600;
        }
        
        .word-display {
            font-size: 32px;
            color: #2980b9;
            margin: 25px 0;
            font-weight: 700;
        }
        
        .options-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .option-btn {
            padding: 15px;
            background-color: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.2s;
        }
        
        .option-btn:hover {
            background-color: #e9ecef;
            transform: translateY(-2px);
        }
        
        .feedback {
            font-size: 22px;
            font-weight: 600;
            margin: 20px 0;
            padding: 15px;
            border-radius: 8px;
        }
        
        .correct {
            background-color: #d4edda;
            color: #155724;
        }
        
        .incorrect {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .results-container {
            padding: 20px;
        }
        
        .result-section {
            margin-bottom: 25px;
        }
        
        .result-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #2c3e50;
            border-bottom: 2px solid #eee;
            padding-bottom: 8px;
        }
        
        .result-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .result-item {
            background-color: #f8f9fa;
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 14px;
        }
        
        .correct-student {
            background-color: #d4edda;
            color: #155724;
        }
        
        .incorrect-student {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .absent-student {
            background-color: #fff3cd;
            color: #856404;
        }
        
        .stats {
            display: flex;
            justify-content: space-around;
            margin: 30px 0;
            text-align: center;
        }
        
        .stat-box {
            padding: 20px;
            border-radius: 10px;
            width: 30%;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .stat-number {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .correct-stat {
            background-color: #d4edda;
            color: #155724;
        }
        
        .incorrect-stat {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .absent-stat {
            background-color: #fff3cd;
            color: #856404;
        }
        
        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        
        #save-results-btn {
            background-color: #2196F3;
        }
        
        #save-results-btn:hover {
            background-color: #0b7dda;
        }
        
        #new-quiz-btn {
            background-color: #FF9800;
        }
        
        #new-quiz-btn:hover {
            background-color: #e68a00;
        }
        
        .progress-bar {
            height: 10px;
            background-color: #f0f0f0;
            border-radius: 5px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .progress {
            height: 100%;
            background-color: #4CAF50;
            border-radius: 5px;
            transition: width 0.3s;
        }
        
        .progress-text {
            text-align: center;
            font-size: 14px;
            color: #666;
            margin-bottom: 20px;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            font-size: 18px;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Vocabulary Quiz & Attendance Tool</h1>
        
        <!-- Setup Section -->
        <div id="setup-section" class="section">
            <div class="loading" id="loading">
                Loading vocabulary data...
            </div>
            <div id="setup-content" style="display: none;">
                <div class="form-group">
                    <label for="word-list">Select Word List:</label>
                    <select id="word-list">
                        <!-- Word lists will be populated here -->
                    </select>
                </div>
                
                <button id="go-btn">Go</button>
            </div>
        </div>
        
        <!-- Quiz Section -->
        <div id="quiz-section" class="section">
            <div class="progress-bar">
                <div class="progress" id="progress-bar"></div>
            </div>
            <div class="progress-text" id="progress-text">Question 0 of 0</div>
            
            <div class="quiz-card">
                <div class="student-name" id="student-name">Student Name</div>
                <div class="word-display" id="word-display">Vocabulary Word</div>
                
                <div class="options-container" id="options-container">
                    <!-- Options will be inserted here -->
                </div>
                
                <div id="feedback" class="feedback" style="display: none;"></div>
                
                <button id="not-here-btn">Not Here</button>
                <button id="next-btn" style="display: none;">Next Student</button>
            </div>
        </div>
        
        <!-- Results Section -->
        <div id="results-section" class="section">
            <h2>Quiz Results</h2>
            
            <div class="stats">
                <div class="stat-box correct-stat">
                    <div class="stat-number" id="correct-count">0</div>
                    <div>Correct</div>
                </div>
                <div class="stat-box incorrect-stat">
                    <div class="stat-number" id="incorrect-count">0</div>
                    <div>Incorrect</div>
                </div>
                <div class="stat-box absent-stat">
                    <div class="stat-number" id="absent-count">0</div>
                    <div>Absent</div>
                </div>
            </div>
            
            <div class="result-section">
                <div class="result-title">Students with Correct Answers</div>
                <div class="result-list" id="correct-students">
                    <!-- Correct students will be inserted here -->
                </div>
            </div>
            
            <div class="result-section">
                <div class="result-title">Students with Incorrect Answers</div>
                <div class="result-list" id="incorrect-students">
                    <!-- Incorrect students will be inserted here -->
                </div>
            </div>
            
            <div class="result-section">
                <div class="result-title">Absent Students</div>
                <div class="result-list" id="absent-students">
                    <!-- Absent students will be inserted here -->
                </div>
            </div>
            
            <div class="action-buttons">
                <button id="save-results-btn">Save Results as Image</button>
                <button id="new-quiz-btn">Start New Quiz</button>
            </div>
        </div>
    </div>

    <script>
        // Student list
        const students = [
            "李伟", "王静", "张浩", "刘芳", "陈宇", "杨婷", "赵磊", "黄丽", "周凯", 
            "吴霞", "徐鹏", "孙燕", "郭强", "何梅", "林杰", "高颖", "邓晨", "谢琳", 
            "宋阳", "韩雪", "马超", "傅敏", "蒋涛", "罗慧", "曾昊", "唐婧"
        ];

        // Global variables
        let currentStudentIndex = -1;
        let currentWordIndex = -1;
        let selectedWordList = [];
        let studentStatus = {};
        let wordStatus = {};
        let correctAnswers = 0;
        let incorrectAnswers = 0;
        let absentStudents = 0;
        let totalQuestions = 0;
        let currentOptions = [];
        let correctOptionIndex = -1;
        let allWordLists = [];

        // DOM elements
        const wordListSelect = document.getElementById('word-list');
        const goBtn = document.getElementById('go-btn');
        const quizSection = document.getElementById('quiz-section');
        const resultsSection = document.getElementById('results-section');
        const setupSection = document.getElementById('setup-section');
        const loadingElement = document.getElementById('loading');
        const setupContent = document.getElementById('setup-content');
        const studentNameElement = document.getElementById('student-name');
        const wordDisplayElement = document.getElementById('word-display');
        const optionsContainer = document.getElementById('options-container');
        const feedbackElement = document.getElementById('feedback');
        const notHereBtn = document.getElementById('not-here-btn');
        const nextBtn = document.getElementById('next-btn');
        const correctCountElement = document.getElementById('correct-count');
        const incorrectCountElement = document.getElementById('incorrect-count');
        const absentCountElement = document.getElementById('absent-count');
        const correctStudentsElement = document.getElementById('correct-students');
        const incorrectStudentsElement = document.getElementById('incorrect-students');
        const absentStudentsElement = document.getElementById('absent-students');
        const saveResultsBtn = document.getElementById('save-results-btn');
        const newQuizBtn = document.getElementById('new-quiz-btn');
        const progressBar = document.getElementById('progress-bar');
        const progressText = document.getElementById('progress-text');

        // Initialize student status
        function initializeStudentStatus() {
            studentStatus = {};
            students.forEach(student => {
                studentStatus[student] = { answered: false, correct: false, absent: false };
            });
        }

        // Fetch vocabulary data
        async function fetchVocabularyData() {
            try {
                // Use the raw content URL for GitHub files
                const response = await fetch('https://raw.githubusercontent.com/wangzhrm/IELTS/main/vocab1.json');
                const data = await response.json();
                return data;
            } catch (error) {
                console.error('Error fetching vocabulary data:', error);
                alert('Failed to load vocabulary data. Please try again.');
                return null;
            }
        }

        // Populate word list dropdown
        async function populateWordLists() {
            const vocabData = await fetchVocabularyData();
            if (!vocabData) return;
            
            allWordLists = vocabData;
            
            // Clear existing options
            wordListSelect.innerHTML = '';
            
            // Add new options
            vocabData.forEach((wordList, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = `Word List ${index + 1}`;
                wordListSelect.appendChild(option);
            });
            
            // Hide loading and show content
            loadingElement.style.display = 'none';
            setupContent.style.display = 'block';
        }

        // Start the quiz
        function startQuiz() {
            const wordListIndex = parseInt(wordListSelect.value);
            if (isNaN(wordListIndex)) {
                alert('Please select a word list.');
                return;
            }
            
            selectedWordList = allWordLists[wordListIndex];
            
            // Initialize status trackers
            initializeStudentStatus();
            wordStatus = {};
            selectedWordList.forEach(word => {
                wordStatus[word.word] = { used: false };
            });
            
            correctAnswers = 0;
            incorrectAnswers = 0;
            absentStudents = 0;
            totalQuestions = Math.min(students.length, selectedWordList.length);
            
            // Hide setup section and show quiz section
            setupSection.style.display = 'none';
            quizSection.style.display = 'block';
            
            // Start with first question
            nextQuestion();
        }

        // Get random unused student
        function getRandomUnusedStudent() {
            const unusedStudents = students.filter(student => !studentStatus[student].answered && !studentStatus[student].absent);
            if (unusedStudents.length === 0) return null;
            
            const randomIndex = Math.floor(Math.random() * unusedStudents.length);
            return unusedStudents[randomIndex];
        }

        // Get random unused word
        function getRandomUnusedWord() {
            const unusedWords = selectedWordList.filter(word => !wordStatus[word.word].used);
            if (unusedWords.length === 0) return null;
            
            const randomIndex = Math.floor(Math.random() * unusedWords.length);
            return selectedWordList[randomIndex];
        }

        // Generate options for a word
        function generateOptions(correctWord) {
            const options = [correctWord];
            
            // Add random incorrect options
            while (options.length < 4) {
                const randomIndex = Math.floor(Math.random() * selectedWordList.length);
                const randomWord = selectedWordList[randomIndex];
                
                // Make sure we don't add the correct word again and avoid duplicates
                if (randomWord.word !== correctWord.word && 
                    !options.some(opt => opt.word === randomWord.word)) {
                    options.push(randomWord);
                }
            }
            
            // Shuffle options
            for (let i = options.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [options[i], options[j]] = [options[j], options[i]];
            }
            
            return options;
        }

        // Display question
        function displayQuestion(student, word, options) {
            studentNameElement.textContent = student;
            wordDisplayElement.textContent = word.word;
            
            // Clear previous options
            optionsContainer.innerHTML = '';
            
            // Add new options
            options.forEach((option, index) => {
                const button = document.createElement('button');
                button.className = 'option-btn';
                button.textContent = option.meaning;
                button.addEventListener('click', () => checkAnswer(index));
                optionsContainer.appendChild(button);
            });
            
            // Hide feedback and next button
            feedbackElement.style.display = 'none';
            nextBtn.style.display = 'none';
            notHereBtn.style.display = 'block';
            
            // Update progress
            const answeredCount = Object.values(studentStatus).filter(s => s.answered || s.absent).length;
            const progress = (answeredCount / totalQuestions) * 100;
            progressBar.style.width = `${progress}%`;
            progressText.textContent = `Question ${answeredCount + 1} of ${totalQuestions}`;
        }

        // Check answer
        function checkAnswer(selectedIndex) {
            const student = students[currentStudentIndex];
            
            // Mark student as answered
            studentStatus[student].answered = true;
            
            // Check if answer is correct
            if (selectedIndex === correctOptionIndex) {
                feedbackElement.textContent = 'Well done!';
                feedbackElement.className = 'feedback correct';
                studentStatus[student].correct = true;
                correctAnswers++;
            } else {
                feedbackElement.textContent = `More work is needed. Correct answer: ${currentOptions[correctOptionIndex].meaning}`;
                feedbackElement.className = 'feedback incorrect';
                studentStatus[student].correct = false;
                incorrectAnswers++;
            }
            
            feedbackElement.style.display = 'block';
            nextBtn.style.display = 'block';
            notHereBtn.style.display = 'none';
            
            // Disable option buttons
            const optionButtons = optionsContainer.querySelectorAll('.option-btn');
            optionButtons.forEach(button => {
                button.disabled = true;
            });
        }

        // Mark student as absent
        function markStudentAbsent() {
            const student = students[currentStudentIndex];
            studentStatus[student].absent = true;
            studentStatus[student].answered = true;
            absentStudents++;
            
            nextQuestion();
        }

        // Move to next question
        function nextQuestion() {
            // Get next student and word
            const student = getRandomUnusedStudent();
            const word = getRandomUnusedWord();
            
            // Check if quiz is complete
            if (!student || !word) {
                endQuiz();
                return;
            }
            
            currentStudentIndex = students.indexOf(student);
            currentOptions = generateOptions(word);
            correctOptionIndex = currentOptions.findIndex(option => option.word === word.word);
            
            // Mark word as used
            wordStatus[word.word].used = true;
            
            // Display the question
            displayQuestion(student, word, currentOptions);
        }

        // End quiz and show results
        function endQuiz() {
            quizSection.style.display = 'none';
            resultsSection.style.display = 'block';
            
            // Update result counts
            correctCountElement.textContent = correctAnswers;
            incorrectCountElement.textContent = incorrectAnswers;
            absentCountElement.textContent = absentStudents;
            
            // Display student lists
            correctStudentsElement.innerHTML = '';
            incorrectStudentsElement.innerHTML = '';
            absentStudentsElement.innerHTML = '';
            
            students.forEach(student => {
                const status = studentStatus[student];
                const element = document.createElement('div');
                element.className = 'result-item';
                element.textContent = student;
                
                if (status.absent) {
                    element.classList.add('absent-student');
                    absentStudentsElement.appendChild(element);
                } else if (status.correct) {
                    element.classList.add('correct-student');
                    correctStudentsElement.appendChild(element);
                } else if (status.answered) {
                    element.classList.add('incorrect-student');
                    incorrectStudentsElement.appendChild(element);
                }
            });
        }

        // Save results as image
        function saveResultsAsImage() {
            html2canvas(resultsSection).then(canvas => {
                const link = document.createElement('a');
                link.download = 'quiz-results.png';
                link.href = canvas.toDataURL('image/png');
                link.click();
            });
        }

        // Start new quiz
        function startNewQuiz() {
            resultsSection.style.display = 'none';
            setupSection.style.display = 'block';
            setupContent.style.display = 'block';
            loadingElement.style.display = 'none';
        }

        // Event listeners
        goBtn.addEventListener('click', startQuiz);
        notHereBtn.addEventListener('click', markStudentAbsent);
        nextBtn.addEventListener('click', nextQuestion);
        saveResultsBtn.addEventListener('click', saveResultsAsImage);
        newQuizBtn.addEventListener('click', startNewQuiz);

        // Initialize page
        populateWordLists();
    </script>
</body>
</html>